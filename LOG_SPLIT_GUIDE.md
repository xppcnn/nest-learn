# ğŸ“Š æ—¥å¿—åˆ†çº§å­˜å‚¨ä¸æŒ‰æ—¥æœŸåˆ†å‰² - ä½¿ç”¨æŒ‡å—

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

æ‚¨çš„åº”ç”¨ç°åœ¨æ”¯æŒï¼š
- âœ… **é”™è¯¯æ—¥å¿—å•ç‹¬å­˜å‚¨**ï¼šError/Fatal çº§åˆ«æ—¥å¿—ç‹¬ç«‹ä¿å­˜
- âœ… **å…¶ä»–æ—¥å¿—åˆ†ç¦»å­˜å‚¨**ï¼šInfo/Warn çº§åˆ«æ—¥å¿—å•ç‹¬ä¿å­˜
- âœ… **æŒ‰æ—¥æœŸè‡ªåŠ¨åˆ†å‰²**ï¼šæ¯å¤©è‡ªåŠ¨åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶
- âœ… **è‡ªåŠ¨ç›®å½•ç®¡ç†**ï¼šè‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†æ—¥å¿—ç›®å½•

## ğŸ“ æ—¥å¿—ç›®å½•ç»“æ„

```
nest-learn/
â””â”€â”€ logs/
    â”œâ”€â”€ error/              # é”™è¯¯æ—¥å¿—ç›®å½•
    â”‚   â”œâ”€â”€ 2025-11-05.log
    â”‚   â”œâ”€â”€ 2025-11-06.log
    â”‚   â””â”€â”€ 2025-11-07.log
    â””â”€â”€ info/               # æ™®é€šæ—¥å¿—ç›®å½•
        â”œâ”€â”€ 2025-11-05.log
        â”œâ”€â”€ 2025-11-06.log
        â””â”€â”€ 2025-11-07.log
```

## ğŸ” æ—¥å¿—çº§åˆ«åˆ†ç±»

### Error æ—¥å¿—ç›®å½• (`logs/error/`)
åŒ…å«ä»¥ä¸‹çº§åˆ«çš„æ—¥å¿—ï¼š
- **Error (50)** - é”™è¯¯
- **Fatal (60)** - è‡´å‘½é”™è¯¯

ç¤ºä¾‹ï¼š
```json
{"level":50,"time":1699185600123,"msg":"Database connection failed","error":{"message":"Connection timeout"}}
```

### Info æ—¥å¿—ç›®å½• (`logs/info/`)
åŒ…å«ä»¥ä¸‹çº§åˆ«çš„æ—¥å¿—ï¼š
- **Info (30)** - ä¿¡æ¯
- **Warn (40)** - è­¦å‘Š
- **Debug (20)** - è°ƒè¯•ï¼ˆå¦‚æœå¯ç”¨ï¼‰

ç¤ºä¾‹ï¼š
```json
{"level":30,"time":1699185600123,"msg":"GET /api/cats completed","duration":45}
{"level":40,"time":1699185600456,"msg":"Cat not found","id":999}
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨åº”ç”¨

```bash
# å¼€å‘ç¯å¢ƒï¼ˆæ§åˆ¶å°è¾“å‡ºï¼‰
pnpm run start:dev

# ç”Ÿäº§ç¯å¢ƒï¼ˆå†™å…¥æ–‡ä»¶ï¼‰
NODE_ENV=production pnpm run start:prod
```

### 2. æŸ¥çœ‹æ—¥å¿—

```bash
# ä½¿ç”¨æ—¥å¿—æŸ¥çœ‹å·¥å…·ï¼ˆæ¨èï¼‰
pnpm run logs:view

# æˆ–æ‰‹åŠ¨æŸ¥çœ‹
tail -f logs/error/2025-11-05.log    # å®æ—¶æŸ¥çœ‹ä»Šå¤©çš„é”™è¯¯æ—¥å¿—
tail -f logs/info/2025-11-05.log     # å®æ—¶æŸ¥çœ‹ä»Šå¤©çš„æ™®é€šæ—¥å¿—
```

### 3. æ¸…ç†æ—§æ—¥å¿—

```bash
# æ¸…ç† 7 å¤©å‰çš„æ—¥å¿—ï¼ˆé»˜è®¤ï¼‰
pnpm run logs:clean

# æ¸…ç† 30 å¤©å‰çš„æ—¥å¿—
sh scripts/clean-old-logs.sh 30
```

---

## ğŸ“Š æ—¥å¿—æŸ¥çœ‹å·¥å…·

### äº¤äº’å¼æŸ¥çœ‹å·¥å…·

```bash
pnpm run logs:view
```

æä¾›ä»¥ä¸‹é€‰é¡¹ï¼š
1. **æŸ¥çœ‹ä»Šå¤©çš„é”™è¯¯æ—¥å¿—** - æ˜¾ç¤ºå½“å¤©æ‰€æœ‰é”™è¯¯
2. **æŸ¥çœ‹ä»Šå¤©çš„æ™®é€šæ—¥å¿—** - æ˜¾ç¤ºå½“å¤© info/warn æ—¥å¿—
3. **æŸ¥çœ‹æ‰€æœ‰é”™è¯¯æ—¥å¿—** - æ˜¾ç¤ºå†å²æ‰€æœ‰é”™è¯¯
4. **æŸ¥çœ‹æ‰€æœ‰æ™®é€šæ—¥å¿—** - æ˜¾ç¤ºå†å²æ‰€æœ‰æ™®é€šæ—¥å¿—
5. **å®æ—¶ç›‘æ§é”™è¯¯æ—¥å¿—** - tail -f é”™è¯¯æ—¥å¿—
6. **å®æ—¶ç›‘æ§æ™®é€šæ—¥å¿—** - tail -f æ™®é€šæ—¥å¿—
7. **æ˜¾ç¤ºæ—¥å¿—ç»Ÿè®¡** - æ–‡ä»¶æ•°é‡ã€å¤§å°ã€æ¡ç›®æ•°

### æ‰‹åŠ¨æŸ¥çœ‹å‘½ä»¤

```bash
# æŸ¥çœ‹ä»Šå¤©çš„é”™è¯¯æ—¥å¿—
cat logs/error/$(date +%Y-%m-%d).log

# æŸ¥çœ‹ä»Šå¤©çš„æ™®é€šæ—¥å¿—ï¼ˆæœ€å 50 è¡Œï¼‰
tail -n 50 logs/info/$(date +%Y-%m-%d).log

# å®æ—¶ç›‘æ§é”™è¯¯æ—¥å¿—
tail -f logs/error/$(date +%Y-%m-%d).log

# æœç´¢ç‰¹å®šé”™è¯¯
grep "Database" logs/error/*.log

# ç»Ÿè®¡é”™è¯¯æ•°é‡
cat logs/error/*.log | wc -l
```

---

## ğŸ”§ å·¥ä½œåŸç†

### æ—¥å¿—çº§åˆ«æ£€æµ‹

é…ç½®æ–‡ä»¶ï¼š`src/common/config/logger-split.config.ts`

```typescript
// level >= 50 çš„æ—¥å¿—å†™å…¥ logs/error/
if (level >= 50) {
  writeToErrorLog(chunk);
}
// å…¶ä»–çº§åˆ«å†™å…¥ logs/info/
else {
  writeToInfoLog(chunk);
}
```

### æ—¥æœŸåˆ†å‰²é€»è¾‘

```typescript
// è‡ªåŠ¨ç”Ÿæˆå½“å¤©çš„æ–‡ä»¶å
function getLogFileName(level: 'error' | 'info'): string {
  const date = new Date();
  const dateStr = `${year}-${month}-${day}`;  // 2025-11-05
  return `${dir}/${dateStr}.log`;
}
```

### è‡ªåŠ¨æ–‡ä»¶åˆ‡æ¢

- **åˆå¤œè‡ªåŠ¨åˆ‡æ¢**ï¼šè·¨è¶Šåˆå¤œæ—¶è‡ªåŠ¨åˆ›å»ºæ–°æ–‡ä»¶
- **æ— éœ€é‡å¯**ï¼šåº”ç”¨è¿è¡ŒæœŸé—´è‡ªåŠ¨åˆ‡æ¢ï¼Œæ— éœ€é‡å¯
- **çº¿ç¨‹å®‰å…¨**ï¼šä½¿ç”¨æ–‡ä»¶æµç¡®ä¿å¹¶å‘å†™å…¥å®‰å…¨

---

## ğŸ“ˆ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1ï¼šç›‘æ§ç”Ÿäº§ç¯å¢ƒé”™è¯¯

```bash
# å®æ—¶ç›‘æ§é”™è¯¯æ—¥å¿—
pnpm run logs:view
# é€‰æ‹© 5 (Follow today's error logs)

# æˆ–ç›´æ¥ä½¿ç”¨å‘½ä»¤
tail -f logs/error/$(date +%Y-%m-%d).log
```

### åœºæ™¯2ï¼šåˆ†ææ˜¨å¤©çš„é”™è¯¯

```bash
# æŸ¥çœ‹æ˜¨å¤©çš„é”™è¯¯æ—¥å¿—
cat logs/error/2025-11-04.log

# ç»Ÿè®¡æ˜¨å¤©çš„é”™è¯¯æ•°é‡
cat logs/error/2025-11-04.log | wc -l

# æŸ¥æ‰¾ç‰¹å®šé”™è¯¯
grep "timeout" logs/error/2025-11-04.log
```

### åœºæ™¯3ï¼šå¯¼å‡ºæœ€è¿‘ä¸€å‘¨çš„é”™è¯¯æ—¥å¿—

```bash
# åˆå¹¶æœ€è¿‘ 7 å¤©çš„é”™è¯¯æ—¥å¿—
find logs/error/ -name "*.log" -mtime -7 -exec cat {} \; > errors_last_week.log
```

### åœºæ™¯4ï¼šå®šæœŸæ¸…ç†æ—§æ—¥å¿—

```bash
# æ·»åŠ åˆ° crontabï¼ˆæ¯å¤©å‡Œæ™¨ 2 ç‚¹æ¸…ç† 30 å¤©å‰çš„æ—¥å¿—ï¼‰
0 2 * * * cd /path/to/nest-learn && npm run logs:clean
```

---

## ğŸ¨ æ—¥å¿—æ ¼å¼ç¤ºä¾‹

### Error æ—¥å¿—ç¤ºä¾‹ (`logs/error/2025-11-05.log`)

```json
{"level":50,"time":1699185600123,"context":"CatsService","msg":"Cat not found","id":999}
{"level":50,"time":1699185600456,"context":"HTTP","msg":"POST /api/cats failed: Validation error","request":{"method":"POST","url":"/api/cats"},"error":{"message":"Invalid cat data"}}
```

### Info æ—¥å¿—ç¤ºä¾‹ (`logs/info/2025-11-05.log`)

```json
{"level":30,"time":1699185600123,"msg":"ğŸš€ Application is running on: http://localhost:8866"}
{"level":30,"time":1699185600456,"context":"CatsService","msg":"Finding all cats"}
{"level":30,"time":1699185600789,"context":"HTTP","msg":"GET /api/cats completed","duration":45}
{"level":40,"time":1699185601000,"context":"CatsService","msg":"Cat name already exists","name":"Fluffy"}
```

---

## ğŸ”„ ç¯å¢ƒåˆ‡æ¢

### å¼€å‘ç¯å¢ƒ

```bash
pnpm run start:dev
```

**è¡Œä¸º**ï¼š
- æ—¥å¿—è¾“å‡ºåˆ°**æ§åˆ¶å°**
- å½©è‰²ç¾åŒ–æ ¼å¼
- **ä¸**å†™å…¥æ–‡ä»¶

```
[2025-11-05 12:00:00.123] INFO (CatsService): Finding all cats
[2025-11-05 12:00:00.456] ERROR (CatsService): Cat not found
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
NODE_ENV=production pnpm run start:prod
```

**è¡Œä¸º**ï¼š
- æ—¥å¿—å†™å…¥**æ–‡ä»¶**
- JSON æ ¼å¼
- è‡ªåŠ¨æŒ‰çº§åˆ«å’Œæ—¥æœŸåˆ†å‰²

---

## ğŸ“Š æ—¥å¿—ç»Ÿè®¡ä¸åˆ†æ

### æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯

```bash
pnpm run logs:view
# é€‰æ‹© 7 (Show log statistics)
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ“Š Log Statistics:

Error logs:
  Files: 7
  Total size: 1.2M
  Total errors: 234

Info logs:
  Files: 7
  Total size: 15.8M
  Total entries: 45678
```

### æ‰‹åŠ¨ç»Ÿè®¡å‘½ä»¤

```bash
# ç»Ÿè®¡é”™è¯¯æ—¥å¿—æ–‡ä»¶æ•°
ls logs/error/*.log | wc -l

# ç»Ÿè®¡é”™è¯¯æ€»æ•°
cat logs/error/*.log | wc -l

# ç»Ÿè®¡ä»Šå¤©çš„é”™è¯¯æ•°
cat logs/error/$(date +%Y-%m-%d).log | wc -l

# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶å¤§å°
du -sh logs/error/
du -sh logs/info/
```

---

## ğŸ—‘ï¸ æ—¥å¿—æ¸…ç†ç­–ç•¥

### è‡ªåŠ¨æ¸…ç†è„šæœ¬

```bash
# æ¸…ç† 7 å¤©å‰çš„æ—¥å¿—ï¼ˆé»˜è®¤ï¼‰
pnpm run logs:clean

# æ¸…ç† 30 å¤©å‰çš„æ—¥å¿—
sh scripts/clean-old-logs.sh 30

# æ¸…ç† 90 å¤©å‰çš„æ—¥å¿—
sh scripts/clean-old-logs.sh 90
```

### å®šæ—¶ä»»åŠ¡è®¾ç½®

```bash
# ç¼–è¾‘ crontab
crontab -e

# æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ¸…ç† 30 å¤©å‰çš„æ—¥å¿—
0 2 * * * cd /path/to/nest-learn && sh scripts/clean-old-logs.sh 30

# æ¯å‘¨æ—¥å‡Œæ™¨ 3 ç‚¹æ¸…ç† 90 å¤©å‰çš„æ—¥å¿—
0 3 * * 0 cd /path/to/nest-learn && sh scripts/clean-old-logs.sh 90
```

### ç£ç›˜ç©ºé—´ç›‘æ§

```bash
# æ£€æŸ¥æ—¥å¿—ç›®å½•å ç”¨ç©ºé—´
du -sh logs/

# æŸ¥çœ‹å„å­ç›®å½•å¤§å°
du -sh logs/*/

# æŸ¥çœ‹æœ€å¤§çš„æ—¥å¿—æ–‡ä»¶
find logs/ -type f -exec ls -lh {} \; | sort -k5 -hr | head -10
```

---

## ğŸ” é«˜çº§æœç´¢ä¸åˆ†æ

### ä½¿ç”¨ jq åˆ†æ JSON æ—¥å¿—

```bash
# å®‰è£… jq
brew install jq  # macOS
# or
sudo apt-get install jq  # Linux

# æ ¼å¼åŒ–æ˜¾ç¤ºæ—¥å¿—
cat logs/error/2025-11-05.log | jq '.'

# ç­›é€‰ç‰¹å®šä¸Šä¸‹æ–‡çš„é”™è¯¯
cat logs/error/2025-11-05.log | jq 'select(.context == "CatsService")'

# ç»Ÿè®¡å„ç±»å‹é”™è¯¯æ•°é‡
cat logs/error/*.log | jq -r '.error.type' | sort | uniq -c

# æå–é”™è¯¯æ¶ˆæ¯
cat logs/error/2025-11-05.log | jq -r '.msg'
```

### ä½¿ç”¨ grep æœç´¢

```bash
# æœç´¢åŒ…å«ç‰¹å®šå…³é”®è¯çš„é”™è¯¯
grep -i "database" logs/error/*.log

# æœç´¢ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—
grep "12:00" logs/error/2025-11-05.log

# ç»Ÿè®¡ç‰¹å®šé”™è¯¯å‡ºç°æ¬¡æ•°
grep -c "timeout" logs/error/*.log

# æ˜¾ç¤ºåŒ¹é…è¡Œçš„å‰å 5 è¡Œ
grep -A 5 -B 5 "Connection failed" logs/error/*.log
```

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. æ—¥å¿—ä¿ç•™ç­–ç•¥

| ç¯å¢ƒ | Error æ—¥å¿— | Info æ—¥å¿— |
|-----|-----------|----------|
| å¼€å‘ | 7 å¤© | 3 å¤© |
| æµ‹è¯• | 30 å¤© | 7 å¤© |
| ç”Ÿäº§ | 90 å¤© | 30 å¤© |

### 2. ç›‘æ§å»ºè®®

- **å®æ—¶ç›‘æ§**ï¼šä½¿ç”¨ `tail -f` ç›‘æ§é”™è¯¯æ—¥å¿—
- **å®šæœŸæ£€æŸ¥**ï¼šæ¯å¤©æ£€æŸ¥é”™è¯¯æ—¥å¿—æ•°é‡å’Œç±»å‹
- **å‘Šè­¦è®¾ç½®**ï¼šé”™è¯¯æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶å‘é€å‘Šè­¦

### 3. æ—¥å¿—åˆ†æ

- **æ¯æ—¥æ€»ç»“**ï¼šç»Ÿè®¡æ¯å¤©çš„é”™è¯¯æ•°é‡å’Œç±»å‹
- **è¶‹åŠ¿åˆ†æ**ï¼šè§‚å¯Ÿé”™è¯¯æ—¥å¿—çš„å¢é•¿è¶‹åŠ¿
- **æ ¹å› åˆ†æ**ï¼šé€šè¿‡é”™è¯¯æ—¥å¿—å¿«é€Ÿå®šä½é—®é¢˜

### 4. æ€§èƒ½ä¼˜åŒ–

- **å¼‚æ­¥å†™å…¥**ï¼šæ—¥å¿—å†™å…¥é‡‡ç”¨å¼‚æ­¥æ–¹å¼ï¼Œä¸å½±å“æ€§èƒ½
- **å®šæœŸæ¸…ç†**ï¼šé¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤šå ç”¨ç£ç›˜ç©ºé—´
- **æ—¥å¿—çº§åˆ«**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ `info` çº§åˆ«

---

## ğŸš¨ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæ—¥å¿—æ–‡ä»¶æ²¡æœ‰ç”Ÿæˆ

**æ£€æŸ¥**ï¼š
```bash
# ç¡®è®¤åº”ç”¨ä»¥ç”Ÿäº§æ¨¡å¼è¿è¡Œ
echo $NODE_ENV  # åº”è¯¥è¾“å‡º production

# æ£€æŸ¥æ—¥å¿—ç›®å½•æƒé™
ls -la logs/
```

**è§£å†³**ï¼š
```bash
# æ‰‹åŠ¨åˆ›å»ºç›®å½•
mkdir -p logs/error logs/info
chmod 755 logs/
```

### é—®é¢˜2ï¼šæ—¥å¿—æ²¡æœ‰æŒ‰æ—¥æœŸåˆ†å‰²

**åŸå› **ï¼šå¯èƒ½æ˜¯åº”ç”¨æ²¡æœ‰è·¨è¶Šåˆå¤œè¿è¡Œ

**éªŒè¯**ï¼š
```bash
# æ£€æŸ¥æ˜¯å¦ç”Ÿæˆäº†æ–°çš„æ—¥æœŸæ–‡ä»¶
ls -lt logs/error/
ls -lt logs/info/
```

### é—®é¢˜3ï¼šç£ç›˜ç©ºé—´ä¸è¶³

**æ£€æŸ¥**ï¼š
```bash
# æŸ¥çœ‹æ—¥å¿—å ç”¨ç©ºé—´
du -sh logs/

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h
```

**è§£å†³**ï¼š
```bash
# ç«‹å³æ¸…ç†æ—§æ—¥å¿—
pnpm run logs:clean

# æˆ–æ‰‹åŠ¨åˆ é™¤æ—§æ–‡ä»¶
find logs/ -name "*.log" -mtime +7 -delete
```

---

## ğŸ‰ æ€»ç»“

ç°åœ¨æ‚¨çš„åº”ç”¨å·²ç»é…ç½®äº†å®Œå–„çš„æ—¥å¿—åˆ†çº§å­˜å‚¨ç³»ç»Ÿï¼š

- âœ… Error æ—¥å¿—ç‹¬ç«‹å­˜å‚¨åœ¨ `logs/error/`
- âœ… Info/Warn æ—¥å¿—å­˜å‚¨åœ¨ `logs/info/`
- âœ… è‡ªåŠ¨æŒ‰æ—¥æœŸåˆ†å‰²ï¼ˆæ¯å¤©ä¸€ä¸ªæ–‡ä»¶ï¼‰
- âœ… æä¾›ä¾¿æ·çš„æŸ¥çœ‹å·¥å…·
- âœ… æ”¯æŒè‡ªåŠ¨æ¸…ç†æ—§æ—¥å¿—
- âœ… å¼€å‘ç¯å¢ƒä¸å½±å“ï¼ˆä»ç„¶æ§åˆ¶å°è¾“å‡ºï¼‰

**ç«‹å³å¼€å§‹ä½¿ç”¨ï¼š**
```bash
# 1. å¯åŠ¨åº”ç”¨
NODE_ENV=production pnpm run start:prod

# 2. æŸ¥çœ‹æ—¥å¿—
pnpm run logs:view

# 3. äº«å—ç»“æ„åŒ–çš„æ—¥å¿—ç®¡ç†ï¼
```

